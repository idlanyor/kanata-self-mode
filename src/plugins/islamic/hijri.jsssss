import HijriDate from 'hijri-date';

export const handler = 'hijri'
export const description = 'Menampilkan kalender Hijriyah dan info ibadah'

const bulanHijri = {
    1: 'Muharram',
    2: 'Safar',
    3: 'Rabiul Awal',
    4: 'Rabiul Akhir',
    5: 'Jumadil Awal',
    6: 'Jumadil Akhir',
    7: 'Rajab',
    8: "Sya'ban",
    9: 'Ramadhan',
    10: 'Syawal',
    11: 'Dzulqaidah',
    12: 'Dzulhijjah'
};

const hariPuasaSunnah = {
    // Format: bulan: [tanggal]
    1: [9, 10], // Tasu'a dan 'Asyura
    7: [27], // Isra' Mi'raj
    8: [13, 14, 15], // Ayyamul Bidh
    9: Array.from({length: 30}, (_, i) => i + 1), // Ramadhan
    12: [9], // Arafah
};

function cekPuasaSunnah(date) {
    const bulan = date.getMonth();
    const tanggal = date.getDate();
    
    if (hariPuasaSunnah[bulan]?.includes(tanggal)) {
        switch(bulan) {
            case 1:
                return tanggal === 9 ? "Puasa Tasu'a" : "Puasa 'Asyura";
            case 7:
                return "Puasa Isra' Mi'raj";
            case 8:
                return "Puasa Ayyamul Bidh";
            case 9:
                return "Puasa Ramadhan";
            case 12:
                return "Puasa Arafah";
            default:
                return null;
        }
    }
    
    // Cek Senin-Kamis
    const hariMasehi = new Date().getDay();
    if (hariMasehi === 1) return "Puasa Sunnah Senin";
    if (hariMasehi === 4) return "Puasa Sunnah Kamis";
    
    return null;
}

function cekHariSpesial(date) {
    const bulan = date.getMonth();
    const tanggal = date.getDate();
    
    if (bulan === 1 && tanggal === 10) return "Hari 'Asyura";
    if (bulan === 3 && tanggal === 12) return "Maulid Nabi Muhammad ï·º";
    if (bulan === 7 && tanggal === 27) return "Isra' Mi'raj";
    if (bulan === 9 && tanggal === 1) return "Awal Ramadhan";
    if (bulan === 9 && tanggal === 17) return "Nuzulul Qur'an";
    if (bulan === 10 && tanggal === 1) return "Hari Raya Idul Fitri";
    if (bulan === 12 && tanggal === 10) return "Hari Raya Idul Adha";
    
    return null;
}

export default async ({ sock, m, id, psn, sender }) => {
    try {
        const today = new Date();
        const hijri = new HijriDate();
        
        const puasaHariIni = cekPuasaSunnah(hijri);
        const hariSpesial = cekHariSpesial(hijri);
        
        const message = `â•­â”€ã€Œ *KALENDER HIJRIYAH* ã€
â”œ *Tanggal:* ${hijri.getDate()} ${bulanHijri[hijri.getMonth()]} ${hijri.getFullYear()} H
â”œ *Masehi:* ${today.toLocaleDateString('id-ID', { 
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
})}
â”‚
${hariSpesial ? `â”œ *Event:* ${hariSpesial}
â”‚` : ''}
${puasaHariIni ? `â”œ *Puasa:* ${puasaHariIni}
â”‚` : ''}
â”œ *Catatan:*
â”œ â€¢ Senin & Kamis: Puasa Sunnah
â”œ â€¢ Tanggal 13-15: Puasa Ayyamul Bidh
â”œ â€¢ 'Asyura: 10 Muharram
â”œ â€¢ Arafah: 9 Dzulhijjah
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

_Powered by Antidonasi -V3_`;

        await sock.sendMessage(id, {
            text: message,
            contextInfo: {
                externalAdReply: {
                    title: 'ä¹‚ Kalender Hijriyah ä¹‚',
                    body: `${hijri.getDate()} ${bulanHijri[hijri.getMonth()]} ${hijri.getFullYear()} H`,
                    thumbnailUrl: 'https://files.catbox.moe/2wynab.jpg',
                    sourceUrl: 'https://whatsapp.com/channel/0029VagADOLLSmbaxFNswH1m',
                    mediaType: 1,
                    renderLargerThumbnail: true
                }
            }
        });

        // Kirim reaksi sukses
        await sock.sendMessage(id, {
            react: {
                text: 'ğŸ“…',
                key: m.key
            }
        });

    } catch (error) {
        await sock.sendMessage(id, {
            text: 'âŒ Error: ' + error.message,
            contextInfo: {
                externalAdReply: {
                    title: 'âŒ Hijri Calendar Error',
                    body: 'An error occurred while getting Hijri date',
                    thumbnailUrl: 'https://files.catbox.moe/2wynab.jpg',
                    sourceUrl: 'https://whatsapp.com/channel/0029VagADOLLSmbaxFNswH1m',
                    mediaType: 1,
                }
            }
        });

        // Kirim reaksi error
        await sock.sendMessage(id, {
            react: {
                text: 'âŒ',
                key: m.key
            }
        });
    }
}; 